CuGoArduinoMiddleUserProgrammingクイックリファレンス
<!-- クイックリファレンス はじめ-->
## 目次
- [1. はじめに](#1-はじめに)
- [2. 使い方](#2-使い方)
- [3. 各種関数](#3-各種関数)
  - [3-1. 自動走行関連](#3-1-自動走行関連)
    - [cugo\_move\_forward](#cugo_move_forward)
    - [cugo\_turn\_clockwise](#cugo_turn_clockwise)
    - [cugo\_turn\_counterclockwise](#cugo_turn_counterclockwise)
    - [cugo\_curve\_theta\_raw](#cugo_curve_theta_raw)
    - [cugo\_curve\_distance\_raw](#cugo_curve_distance_raw)
    - [cugo\_stop](#cugo_stop)
    - [cugo\_wait](#cugo_wait)
  - [3-2. 各種センサ取得関連](#3-2-各種センサ取得関連)
    - [cugo\_check\_odometer](#cugo_check_odometer)
    - [cugo\_check\_propo\_channel\_value](#cugo_check_propo_channel_value)
    - [cugo\_check\_button](#cugo_check_button)
    - [cugo\_check\_button\_times](#cugo_check_button_times)
    - [cugo\_check\_button\_press\_time](#cugo_check_button_press_time)
    - [cugo\_reset\_button\_times](#cugo_reset_button_times)
  - [3-3. その他](#3-3-その他)
    - [cugo\_setup](#cugo_setup)
    - [cugo\_rcmode](#cugo_rcmode)
    - [cugo\_motor\_direct\_instructions](#cugo_motor_direct_instructions)
- [4. 参考：MotorClass関連](#4-参考motorclass関連)
    - [driveMotor()](#drivemotor)
    - [reset\_PID\_param](#reset_pid_param)
    - [setTargetRpm](#settargetrpm)
    - [getTargetRpm](#gettargetrpm)
    - [getCount](#getcount)
    - [getRpm](#getrpm)
    - [getSpeed](#getspeed)

<a id="anchor1"></a>

# 1. はじめに

- CugoArduinoMiddleUserProgrammingに関するクイックリファレンスです。中級者向けプログラミング用にCugoを動かす上での各種関数等を説明します。
- CugoArduinoMiddleUserProgrammingを動かすための準備は`○○○`を参照して下さい。

<a id="anchor2"></a>

# 2. 使い方

- 中級車向けプログラミング用の自作関数を利用する場合は`loop()`内の `//ここから自動走行モードの記述`から `//ここまで自動走行モードの記述`までに記載してください。

```c
void loop()
{
  cugo_check_mode_change(cugo_motor_controllers);
  if (cugoRunMode == CUGO_RC_MODE){ //RC（ラジコン）操作    
    cugo_rcmode(cugoRcTime,cugo_motor_controllers);
  }
  if (cugoRunMode == CUGO_ARDUINO_MODE){
    //ここから自動走行モードの記述

    //ここまで自動走行モードの記述
      cugoRunMode = CUGO_RC_MODE; //自動走行をループさせたい場合はCUGO_ARDUINO_MODEに変更
  }
}
```

<a id="anchor3"></a>

# 3. 各種関数

<a id="anchor3-1"></a>

## 3-1. 自動走行関連
<a id="anchor3-1-1"></a>
自動走行はMotorControllerクラスを利用します。

### cugo_move_forward
- 【説明】
  - Cugoが前進後進する関数です
  - rawについては説明で補足PIDなし（※サーボ信号に変更）
- 【構文】
  -  `cugo_move_forward(float target_distance,MotorController cugo_motor_controllers[MOTOR_NUM])`
  -  `cugo_move_forward(float target_distance,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM])`
  - `cugo_move_forward_raw(float target_distance,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM])`
- 【パラメータ】
  - `target_distance` 目標距離:単位はm(float)
  - `target_rpm` 上限速度:単位はrpm (float)
  - 要説明MotorControllerのクラスがあること
  - `cugo_motor_controllers[MOTOR_NUM]` モータークラス：変更不要
- 【戻り値】
  - なし

<a id="anchor3-1-2"></a>

### cugo_turn_clockwise
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-1-3"></a>

### cugo_turn_counterclockwise
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-1-4"></a>

### cugo_curve_theta_raw
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-1-5"></a>

### cugo_curve_distance_raw
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-1-6"></a>

### cugo_stop
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-1-7"></a>

### cugo_wait
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-2"></a>

## 3-2. 各種センサ取得関連

<a id="anchor3-2-1"></a>

### cugo_check_odometer
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-2-1"></a>

### cugo_check_propo_channel_value
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-2-3"></a>

### cugo_check_button
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-2-4"></a>

### cugo_check_button_times
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-2-5"></a>

### cugo_check_button_press_time
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-2-6"></a>

### cugo_reset_button_times
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-3"></a>

## 3-3. その他

<a id="anchor3-3-1"></a>

### cugo_setup
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-3-2"></a>

### cugo_rcmode
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor3-3-3"></a>

### cugo_motor_direct_instructions
- 【説明】
  - ラジコン操作の初期設定する際に利用します。
  - ラジコン操作については★を参照して下さい。
- 【構文】
  - 
- 【パラメータ】
  - なし
- 【戻り値】
  - なし

<a id="anchor4"></a>

# 4. 参考：MotorClass関連

<a id="anchor4-1"></a>

### driveMotor()

<a id="anchor4-2"></a>

### reset_PID_param

<a id="anchor4-3"></a>

### setTargetRpm

<a id="anchor4-4"></a>

### getTargetRpm

<a id="anchor4-5"></a>

### getCount

<a id="anchor4-6"></a>

### getRpm

<a id="anchor4-7"></a>

### getSpeed

<!-- クイックリファレンス ここまで-->


- **init_KOPROPO 時計回りに回転の実行**
  - 【説明】
      - ラジコン操作の初期設定する際に利用します。
      - ラジコン操作については★を参照して下さい。
  - 【構文】
    - init_KOPROPO()
  - 【パラメータ】
    - なし
  - 【戻り値】
    - なし
 自動走行関連
- **cugo_move_forward 直進の実行**
  - 【説明】
    - cugoを自動走行モードで前進または後進する際に利用します
    - ※要説明MotorControllerのクラスがあること（クラスの説明）利用することで左右のモーターについて補足
    - rawについては説明で補足PIDなし（※サーボ信号に変更）
  - 【構文】
    - cugo_move_forward(float target_distance,MotorController  cugo_motor_controllers[MOTOR_NUM]);
    - cugo_move_forward(float target_distance,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);
    - cugo_move_forward_raw(float target_distance,float target_rpm（変更：プロポの値差分の値＋ーをチョクで代入）,MotorController cugo_motor_controllers[MOTOR_NUM]);
  - 【パラメータ】
    - target_distance 目標距離:単位はm(float)
    - target_rpm 上限速度:単位はrpm (float)
    - ※要説明MotorControllerのクラスがあること
    - cugo_motor_controllers[MOTOR_NUM] モータークラス：変更不要
  - 【戻り値】
    - なし
- **cugo_turn_clockwise 時計回りに回転の実行**
  - 【説明】
    - cugoを自動走行モードで時計回りの回転を実行する際に利用します
    - ※要説明MotorControllerのクラスがあること（クラスの説明）利用することで左右のモーターについて補足
    - rawについては説明で補足PIDなし（※サーボ信号に変更）
  - 【構文】
    - cugo_turn_clockwise(float target_degree,MotorController cugo_motor_controllers[MOTOR_NUM])
    - cugo_turn_clockwise(float target_degree,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM])
    - cugo_turn_clockwise_raw(float target_degree,float target_rpm（ラジコン操作入力値の差分＋－）,MotorController cugo_motor_controllers[MOTOR_NUM])
  - 【パラメータ】
    - target_distance 目標距離:単位はm(float)
    - target_rpm 上限速度:単位はrpm (float)
    - ※要説明MotorControllerのクラスがあること
    - cugo_motor_controllers[MOTOR_NUM] モータークラス：変更不要
  - 【戻り値】
    - なし
- **cugo_turn_counterclockwise 時計回りに回転の実行**
  - 【説明】
    - cugoを自動走行モードで反時計回りの回転を実行する際に利用します
    - ※要説明MotorControllerのクラスがあること（クラスの説明）利用することで左右のモーターについて補足
    - rawについては説明で補足PIDなし（※サーボ信号に変更）
  - 【構文】
    - 
  - 【パラメータ】
    - 
  - 【戻り値】
- **cugo_check_a_channel_value 取得**
  - 【説明】
    - KOPOROのチャンネルの値を取得する際に利用します。
  - 【構文】
    - cugo_check_a_channel_value()
    - cugo_check_a_channel_value()
    - cugo_check_a_channel_value()
  - 【パラメータ】
    - なし
  - 【戻り値】
    - KOPOROの値を実施します
- **cugo_check_button_value 押されているか**
  - 【説明】
    - 現在のボタンが押されているかを取得する際に利用します。
    - ※valueに変更
  - 【構文】
    - cugo_check_button_value()
  - 【パラメータ】
    - なし
  - 【戻り値】
    - bool
      - true:押されている状態
      - false:離れている状態
- **cugo_check_button_times 押された回数**
  - 【説明】
    - ボタンの押された回数を取得する際に利用します。
  - 【構文】
    - cugo_check_button_times()
  - 【パラメータ】
    - なし
  - 【戻り値】
    - int型 
- **cugo_reset_button_times リセット**
  - 【説明】
    - ボタンの押された回数の総計をリセットします。
  - 【構文】
    - cugo_reset_button_times()
  - 【パラメータ】
    - なし
  - 【戻り値】
    - なし
- **cugo_button_press_time 押されている時間**
  - 【説明】
    - ボタンの押されている時間（ミリ秒）を取得します。
  - 【構文】
    - cugo_button_press_time
  - 【パラメータ】
    - なし
  - 【戻り値】
    - unsingned int
cugo_check_a_channel_value
//各種関数
  void init_display();
  void init_KOPROPO(int OLD_PWM_IN_PIN0_VALUE,int OLD_PWM_IN_PIN1_VALUE,int OLD_PWM_IN_PIN2_VALUE);
  void calc_necessary_rotate(float degree); 
  void calc_necessary_count(float distance); 
  void reset_pid_gain(MotorController cugo_motor_controllers[MOTOR_NUM]);

/*-----------------------------------------------*/
/*MiddleUser向け関数*/ //★motorclassのたんなるラップアップは不要
  //初期設定関数関連
  void cugo_init();
  void cugo_check_mode_change(MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_keep_speed_ms(unsigned long int wait_ms,MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_keep_stop_ms(unsigned long int wait_ms,MotorController cugo_motor_controllers[MOTOR_NUM]);

  void cugo_motor_direct_instructions(int left, int right,MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_rcmode(volatile unsigned long cugoRcTime[PWM_IN_MAX],MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_stop(MotorController cugo_motor_controllers[MOTOR_NUM]);


  //前進制御＆回転制御
  //目標距離に前進または後進　位置制御あり
  void cugo_move_forward(float target_distance,MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_move_forward(float target_distance,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);//単位はm,rpm
  void cugo_move_forward_raw(float target_distance,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);//単位はm,rpm
  //目標角度に回転　位置制御あり
  void cugo_turn_counterclockwise(float target_degree,MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_turn_counterclockwise(float target_degree,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);//単位はm,rpm
  void cugo_turn_counterclockwise_raw(float target_degree,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);//単位はm,rpm  
  //極座標での移動命令※言葉変える　curve_forward?とか
  void cugo_polar_coordinates_theta_raw(float target_radius,float target_theta,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_polar_coordinates_distance_raw(float target_radius,float target_disttance,float target_rpm,MotorController cugo_motor_controllers[MOTOR_NUM]);

  //カウント数のチェック
  int cugo_check_count_achivement(MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_move_pid(float target_rpm,bool use_pid,MotorController cugo_motor_controllers[MOTOR_NUM]);//単位はm,rpm
  //モーター制御
  int cugo_check_a_channel_value(); //現状のachの値取得
  int cugo_check_b_channel_value(); //現状のbchの値取得
  int cugo_check_c_channel_value(); //現状のcchの値取得
  
  bool cugo_check_button(); //現状の押されているか
  int cugo_check_button_times(); //現状の押された回数
  void cugo_reset_button_times(); //現状の押された回数
  long int cugo_button_press_time(); //ボタンの押されている時間
  //オドメトリ計算
  float cugo_check_odometer(int check_number,MotorController cugo_motor_controllers[MOTOR_NUM]); 
  void cugo_calc_odometer(MotorController cugo_motor_controllers[MOTOR_NUM]);
  void cugo_reset_odometer(int check_number);

  //以下よく使うであろうMotorController
  /*
   * driveMotor():モーターへサーボ入力　入力値は事前に設定されたsetTargetRpmの値とPID速度制御から算出
   * reset_PID_param() PIDのパラメータを初期化
   * setTargetRpm(float target_rpm) 目標ＲＰＭを設定
   * getTargetRpm()　目標RPM値を取得
   * getCount()　現状のカウント数を把握
   * getRpm()　現状のRPM値を取得　getrpmの前にcalcRpm()をしておくとより正確
   * getSpeed() 現状の速度を取得
  
  */
  
